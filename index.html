<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Catálogo MV Clothing - Demo</title>

<style>
  /* RESET / BASE */
  *, *::before, *::after { box-sizing: border-box; }
  html, body { 
    height: auto; /* Cambiado de 100% para permitir que el fondo crezca */
    min-height: 100%; 
  }
  body {
    font-family: "Segoe UI", Arial, sans-serif;
    margin: 0;
    color: #333;
    background-image: url("fondo.jpg");
    
    /* --- CORRECCIÓN DEL FONDO --- */
    background-repeat: repeat;      /* Permite que la imagen se repita */
    background-attachment: fixed;   /* Hace que el fondo se quede quieto mientras el contenido baja */
    background-size: auto;          /* Evita que se estire demasiado y pierda calidad */
    /* ---------------------------- */

    position: relative;
  }
  body::before {
    content: ""; 
    position: fixed; 
    inset: 0;
    background: rgba(255,255,255,0.35); 
    z-index: -1;
  }

  /* NAVBAR */
  .navbar {
    display: flex; align-items: center; justify-content: space-between;
    background: rgba(255,255,255,0.95);
    padding: 10px 18px; box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    position: sticky; top: 0; z-index: 1000;
  }
  .navbar img { width: 36px; height: 36px; }
  .navbar h1 { margin: 0; font-size: 1.1rem; color: #444; flex: 1; text-align: center; }
  .navbar a { background: #c3b384; color: #736c30; padding: 8px 12px; border-radius: 6px; text-decoration: none; font-weight: 600; }

  /* BUSCADOR */
  .buscador { display: flex; gap: 12px; padding: 14px; justify-content: center; align-items: center; flex-wrap: wrap; }
  .buscador input { flex: 1; min-width: 160px; max-width: 600px; padding: 10px; border-radius: 6px; border: 1px solid #ddd; }
  .buscador select { padding: 10px; border-radius: 6px; border: 1px solid #ddd; }

  /* GRID */
  .catalogo {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 18px;
    padding: 18px;
    max-width: 1200px;
    margin: 0 auto;
  }
  @media (min-width: 1400px) { .catalogo { grid-template-columns: repeat(3, 1fr); } }

  /* TARJETA PRODUCTO */
  .producto {
    background: #fff; border-radius: 10px; overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    display: flex; flex-direction: column; gap: 10px;
    padding: 14px; min-height: 400px; justify-content: flex-start;
  }
  .producto h2 { font-size: 1rem; margin: 0; line-height: 1.2; color: #222; }
  .meta { color: #555; font-size: 0.9rem; margin: 0; }
  .precio { color: #736c30; font-weight: 700; font-size: 1rem; margin: 0; }
  .disponibilidad { font-size: 0.85rem; color: #2a7a2a; margin: 0; }

  /* CARRUSEL */
  .carrusel { 
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    gap: 12px; 
    margin-top: auto;
  }
  
  .imagen-carrusel {
    width: 100%; 
    height: 250px; 
    object-fit: contain; 
    border-radius: 6px; 
    background: #f6f6f6;
    cursor: pointer;
  }

  .controles-carrusel {
    display: flex;
    justify-content: center;
    gap: 15px;
    width: 100%;
  }

  .flecha { 
    background: #c3b384; 
    color: #736c30; 
    border: none; 
    padding: 6px 20px; 
    border-radius: 6px; 
    cursor: pointer; 
    font-weight: bold;
    font-size: 1rem;
  }

  /* PAGINACIÓN */
  #paginacion { 
    text-align: center; 
    padding: 20px 12px 80px 12px; 
  }
  #paginacion button { margin: 4px; padding: 8px 12px; border-radius: 6px; border: none; background: #c3b384; color: #fff; cursor: pointer; font-weight: 600; }
  #paginacion button.active { background: #736c30; color: #fff; transform: translateY(-1px); }

  /* LIGHTBOX */
  .lightbox { position: fixed; inset: 0; display: none; justify-content: center; align-items: center; background: rgba(0,0,0,0.85); z-index: 9999; }
  .lightbox img { max-width: 92%; max-height: 92%; border-radius: 8px; }

  /* WHATSAPP FLOAT */
  .whatsapp-float { 
    position: fixed; 
    bottom: 20px; 
    right: 20px; 
    background: #25d366; 
    color: #fff; 
    border-radius: 50px; 
    display: flex; 
    align-items: center; 
    padding: 10px 14px; 
    text-decoration: none; 
    box-shadow: 0 6px 18px rgba(0,0,0,0.25); 
    z-index: 10000;
  }
  .whatsapp-float img { width: 28px; height: 28px; margin-right: 8px; }

  /* RESPONSIVE MÓVIL */
  @media (max-width: 600px) {
    .catalogo { grid-template-columns: 1fr; padding: 12px; gap: 14px; }
    .producto { min-height: unset; height: auto; }
    .imagen-carrusel { height: 220px; }
    
    .flecha {
      padding: 6px 18px;
      font-size: 0.9rem;
    }
    .whatsapp-float span { font-size: 0.9rem; }
  }

  @keyframes fadeIn { from { opacity: 0 } to { opacity: 1 } }
</style>
</head>
<body>
  <div class="navbar">
    <img src="favicon.ico" alt="logo">
    <h1>Catálogo MV Clothing</h1>
    <a href="https://wa.link/ybhv7u" target="_blank" rel="noopener">Ordena aquí</a>
  </div>

  <div class="buscador">
    <input id="buscador" placeholder="Busca por prenda, marca, talla, color...">
    <select id="orden">
      <option value="titulo">Título</option>
      <option value="precioAsc">Precio (menor a mayor)</option>
      <option value="precioDesc">Precio (mayor a menor)</option>
    </select>
  </div>

  <div id="catalogo" class="catalogo"></div>
  <div id="paginacion"></div>

  <div id="lightbox" class="lightbox" aria-hidden="true"><img id="lightbox-img" src="" alt=""></div>

  <a href="https://wa.link/ybhv7u" class="whatsapp-float" target="_blank" rel="noopener">
    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="wa"><span>Contáctanos</span>
  </a>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <script>
  /* ====== Render y lógica completa (robusta) ====== */

  // Paginación / listas
  let productosPorPagina = 12;
  let paginaActual = 1;
  let todosProductos = [];
  let productosActivos = [];

  // Cargar CSV y renderizar tarjetas
  Papa.parse("productos.csv", {
    download: true,
    header: true,
    complete: function(results) {
      const cont = document.getElementById('catalogo');
      cont.innerHTML = '';

      results.data.forEach((p, idx) => {
        if (!p.Titulo) return;
        const div = document.createElement('div');
        div.className = 'producto';

        const imagenes = (p.Imagen || '').replace(/"/g,'').split(',').map(s=>s.trim()).filter(Boolean);
        const firstImg = imagenes[0] || 'https://via.placeholder.com/600x600?text=Sin+imagen';
        const idCarr = `carr-${idx}`;

      div.innerHTML = `
        <h2>${p.Titulo}</h2>
        <p class="meta">${p.Descripcion || ''}</p>
        <p class="precio"><strong>Precio:</strong> Bs.${p.Precio || ''}</p>
        <p class="disponibilidad"><strong>Disponibilidad:</strong> ${p.Disponibilidad || ''}</p>
        <div class="carrusel" id="${idCarr}">
          <img class="imagen-carrusel" src="${firstImg}" alt="${p.Titulo}">
          <div class="controles-carrusel">
            <button class="flecha izq" type="button" data-carr="${idCarr}" data-dir="-1">◀</button>
            <button class="flecha der" type="button" data-carr="${idCarr}" data-dir="1">▶</button>
          </div>
        </div>
      `;
        div.dataset.imagenes = JSON.stringify(imagenes);
        div.dataset.indice = "0";
        cont.appendChild(div);
      });

      // inicializar listas y UI
      inicializarListas();
    },
    error: function() {
      // si falla, inicializar listas vacías para evitar errores
      inicializarListas();
    }
  });

  // Inicializar listas y paginación
  function inicializarListas() {
    todosProductos = Array.from(document.querySelectorAll('.producto'));
    productosActivos = todosProductos.slice();
    crearPaginacion(productosActivos.length);
    mostrarPagina(1);
  }

  // Mostrar página (no forzar display:flex)
  function mostrarPagina(pagina) {
    paginaActual = pagina || 1;
    const inicio = (paginaActual - 1) * productosPorPagina;
    const fin = paginaActual * productosPorPagina;

    todosProductos.forEach(el => el.style.display = 'none');
    productosActivos.forEach((el, idx) => {
      el.style.display = (idx >= inicio && idx < fin) ? '' : 'none';
    });

    actualizarBotonesPaginacion();
  }

  function crearPaginacion(total) {
    const totalPag = Math.max(1, Math.ceil(total / productosPorPagina));
    const pagDiv = document.getElementById('paginacion');
    pagDiv.innerHTML = '';
    for (let i=1;i<=totalPag;i++){
      const btn = document.createElement('button');
      btn.type='button'; btn.innerText = i; btn.dataset.page = i;
      btn.addEventListener('click', ()=> mostrarPagina(i));
      pagDiv.appendChild(btn);
    }
    actualizarBotonesPaginacion();
  }

  function actualizarBotonesPaginacion(){
    const botones = Array.from(document.querySelectorAll('#paginacion button'));
    botones.forEach(b => {
      if (parseInt(b.dataset.page,10) === paginaActual) b.classList.add('active');
      else b.classList.remove('active');
    });
  }

  // Buscador
  const buscador = document.getElementById('buscador');
  buscador.addEventListener('input', function(){
    const q = this.value.trim().toLowerCase();
    if (!q) productosActivos = todosProductos.slice();
    else productosActivos = todosProductos.filter(p => p.innerText.toLowerCase().includes(q));
    crearPaginacion(productosActivos.length);
    mostrarPagina(1);
  });

  // Ordenar
  const ordenEl = document.getElementById('orden');
  ordenEl.addEventListener('change', function(){
    const criterio = this.value;
    const cont = document.getElementById('catalogo');
    const lista = productosActivos.length ? productosActivos : todosProductos;
    lista.sort((a,b) => {
      if (criterio === 'titulo') return a.querySelector('h2').innerText.localeCompare(b.querySelector('h2').innerText);
      const pa = extraerPrecio(a), pb = extraerPrecio(b);
      return criterio === 'precioAsc' ? pa - pb : pb - pa;
    });
    lista.forEach(i => cont.appendChild(i));
    // actualizar referencias
    if (productosActivos.length) productosActivos = lista.slice();
    else { todosProductos = lista.slice(); productosActivos = todosProductos.slice(); }
    crearPaginacion(productosActivos.length);
    mostrarPagina(1);
  });

  function extraerPrecio(el){
    const p = Array.from(el.querySelectorAll('p')).find(x => x.innerText.toLowerCase().includes('precio'));
    if (!p) return 0;
    const txt = p.innerText.replace(/[^0-9.,-]/g,'').replace(',','.');
    return parseFloat(txt) || 0;
  }

  // Carrusel: delegación de eventos para flechas
  document.addEventListener('click', function(e){
    const btn = e.target.closest('button[data-carr]');
    if (btn) {
      const id = btn.dataset.carr;
      const dir = parseInt(btn.dataset.dir,10);
      const carr = document.getElementById(id);
      if (!carr) return;
      const tarjeta = carr.closest('.producto');
      const imgs = JSON.parse(tarjeta.dataset.imagenes || '[]');
      if (!imgs.length) return;
      let idx = parseInt(tarjeta.dataset.indice || '0',10);
      idx = (idx + dir + imgs.length) % imgs.length;
      tarjeta.dataset.indice = idx;
      const imgEl = carr.querySelector('.imagen-carrusel');
      if (imgEl) imgEl.src = imgs[idx] || imgEl.src;
    }
  });

  // Lightbox: delegación robusta
  const lightbox = document.getElementById('lightbox');
  const lightboxImg = document.getElementById('lightbox-img');

  document.addEventListener('click', function(e){
    const img = e.target.closest && e.target.closest('img.imagen-carrusel');
    if (img) {
      lightboxImg.src = img.src;
      lightboxImg.alt = img.alt || '';
      lightbox.style.display = 'flex';
      lightbox.setAttribute('aria-hidden','false');
      e.stopPropagation();
    }
  });

  lightbox.addEventListener('click', function(e){
    if (e.target === lightbox || e.target !== lightboxImg) {
      lightbox.style.display = 'none';
      lightbox.setAttribute('aria-hidden','true');
      lightboxImg.src = '';
    }
  });
  document.addEventListener('keydown', function(e){
    if (e.key === 'Escape' && lightbox.style.display === 'flex') {
      lightbox.style.display = 'none';
      lightbox.setAttribute('aria-hidden','true');
      lightboxImg.src = '';
    }
  });

  // Exponer para depuración rápida
  window._catalog = {
    todos: () => todosProductos.slice(),
    activos: () => productosActivos.slice(),
    mostrarPagina
  };
  </script>
</body>
</html>