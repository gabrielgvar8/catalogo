<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Catálogo MV Clothing - Demo</title>

<style>
  /* RESET / BASE */
  *, *::before, *::after { box-sizing: border-box; }
  html, body { 
    height: auto; /* Cambiado de 100% para permitir que el fondo crezca */
    min-height: 100%; 
  }
  body {
    font-family: "Segoe UI", Arial, sans-serif;
    margin: 0;
    color: #333;
    background-image: url("fondo.jpg");
    
    /* --- CORRECCIÓN DEL FONDO --- */
    background-repeat: repeat;      /* Permite que la imagen se repita */
    background-attachment: fixed;   /* Hace que el fondo se quede quieto mientras el contenido baja */
    background-size: auto;          /* Evita que se estire demasiado y pierda calidad */
    /* ---------------------------- */

    position: relative;
  }
  body::before {
    content: ""; 
    position: fixed; 
    inset: 0;
    background: rgba(255,255,255,0.35); 
    z-index: -1;
  }

  /* NAVBAR */
  .navbar {
    display: flex; align-items: center; justify-content: space-between;
    background: rgba(255,255,255,0.95);
    padding: 10px 18px; box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    position: sticky; top: 0; z-index: 1000;
  }
  .navbar img { width: 36px; height: 36px; }
  .navbar h1 { margin: 0; font-size: 1.1rem; color: #444; flex: 1; text-align: center; }
  .navbar a { background: #c3b384; color: #736c30; padding: 8px 12px; border-radius: 6px; text-decoration: none; font-weight: 600; }

  /* BUSCADOR */
  .buscador { display: flex; gap: 12px; padding: 14px; justify-content: center; align-items: center; flex-wrap: wrap; }
  .buscador input { flex: 1; min-width: 160px; max-width: 600px; padding: 10px; border-radius: 6px; border: 1px solid #ddd; }
  .buscador select { padding: 10px; border-radius: 6px; border: 1px solid #ddd; }

  /* GRID */
  .catalogo {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 18px;
    padding: 18px;
    max-width: 1200px;
    margin: 0 auto;
  }
  @media (min-width: 1400px) { .catalogo { grid-template-columns: repeat(3, 1fr); } }

  /* TARJETA PRODUCTO */
  .producto {
    background: #fff; border-radius: 10px; overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    display: flex; flex-direction: column; gap: 10px;
    padding: 14px; min-height: 400px; justify-content: flex-start;
  }
  .producto h2 { font-size: 1rem; margin: 0; line-height: 1.2; color: #222; }
  .meta { color: #555; font-size: 0.9rem; margin: 0; }
  .precio { color: #736c30; font-weight: 700; font-size: 1rem; margin: 0; }
  .disponibilidad { font-size: 0.85rem; color: #2a7a2a; margin: 0; }

  /* CARRUSEL */
  .carrusel { 
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    gap: 12px; 
    margin-top: auto;
  }
  
  .imagen-carrusel {
    width: 100%; 
    height: 250px; 
    object-fit: contain; 
    border-radius: 6px; 
    background: #f6f6f6;
    cursor: pointer;
  }

  .controles-carrusel {
    display: flex;
    justify-content: center;
    gap: 15px;
    width: 100%;
  }

  .flecha { 
    background: #c3b384; 
    color: #736c30; 
    border: none; 
    padding: 6px 20px; 
    border-radius: 6px; 
    cursor: pointer; 
    font-weight: bold;
    font-size: 1rem;
  }

  /* PAGINACIÓN */
  #paginacion { 
    text-align: center; 
    padding: 20px 12px 80px 12px; 
  }
  #paginacion button { margin: 4px; padding: 8px 12px; border-radius: 6px; border: none; background: #c3b384; color: #fff; cursor: pointer; font-weight: 600; }
  #paginacion button.active { background: #736c30; color: #fff; transform: translateY(-1px); }

  /* LIGHTBOX */
  .lightbox { position: fixed; inset: 0; display: none; justify-content: center; align-items: center; background: rgba(0,0,0,0.85); z-index: 9999; }
  .lightbox img { max-width: 92%; max-height: 92%; border-radius: 8px; }

  /* WHATSAPP FLOAT */
  .whatsapp-float { 
    position: fixed; 
    bottom: 20px; 
    right: 20px; 
    background: #25d366; 
    color: #fff; 
    border-radius: 50px; 
    display: flex; 
    align-items: center; 
    padding: 10px 14px; 
    text-decoration: none; 
    box-shadow: 0 6px 18px rgba(0,0,0,0.25); 
    z-index: 10000;
  }
  .whatsapp-float img { width: 28px; height: 28px; margin-right: 8px; }

  /* RESPONSIVE MÓVIL */
  @media (max-width: 600px) {
    .catalogo { grid-template-columns: 1fr; padding: 12px; gap: 14px; }
    .producto { min-height: unset; height: auto; }
    .imagen-carrusel { height: 220px; }
    
    .flecha {
      padding: 6px 18px;
      font-size: 0.9rem;
    }
    .whatsapp-float span { font-size: 0.9rem; }
  }

  @keyframes fadeIn { from { opacity: 0 } to { opacity: 1 } }
  /* Spinner de carga para las imágenes */
.carrusel {
  position: relative; /* Necesario para posicionar el spinner */
}

.carrusel.loading::after {
  content: "";
  position: absolute;
  top: 40%;
  left: 50%;
  width: 30px;
  height: 30px;
  margin-left: -15px;
  border: 4px solid rgba(195, 179, 132, 0.3);
  border-top-color: #736c30;
  border-radius: 50%;
  animation: girar 0.8s linear infinite;
  z-index: 5;
}
.contador-fotos {
  font-size: 0.85rem;
  color: #736c30;
  margin-top: 5px;
  font-weight: 700;
}
@keyframes girar {
  to { transform: rotate(360deg); }
}

/* Opcional: opacidad baja en la imagen mientras carga */
.carrusel.loading .imagen-carrusel {
  opacity: 0.6;
  filter: grayscale(0.5);
}
</style>
</head>
<body>
  <div class="navbar">
    <img src="favicon.ico" alt="logo">
    <h1>Catálogo MV Clothing</h1>
    <a href="https://wa.link/ybhv7u" target="_blank" rel="noopener">Ordena aquí</a>
  </div>

  <div class="buscador">
    <input id="buscador" placeholder="Busca por prenda, marca, talla, color...">
    <select id="orden">
      <option value="titulo">Título</option>
      <option value="precioAsc">Precio (menor a mayor)</option>
      <option value="precioDesc">Precio (mayor a menor)</option>
    </select>
  </div>

  <div id="catalogo" class="catalogo"></div>

  <div id="paginacion"></div>

  <div id="lightbox" class="lightbox" aria-hidden="true">
    <img id="lightbox-img" src="" alt="">
  </div>

  <a href="https://wa.link/ybhv7u" class="whatsapp-float" target="_blank" rel="noopener">
    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="wa">
    <span>Contáctanos</span>
  </a>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <script>
    /* ====== CONFIGURACIÓN Y VARIABLES ====== */
    let productosPorPagina = 12;
    let paginaActual = 1;
    let todosProductos = [];
    let productosActivos = [];

    /* ====== CARGA DE DATOS (CSV) ====== */
    Papa.parse("productos.csv", {
      download: true,
      header: true,
      complete: function(results) {
        const cont = document.getElementById('catalogo');
        cont.innerHTML = '';

        results.data.forEach((p, idx) => {
          if (!p.Titulo) return;
          const div = document.createElement('div');
          div.className = 'producto';

          const imagenes = (p.Imagen || '').replace(/"/g, '').split(',').map(s => s.trim()).filter(Boolean);
          const firstImg = imagenes[0] || 'https://via.placeholder.com/600x600?text=Sin+imagen';
          const idCarr = `carr-${idx}`;

          div.innerHTML = `
            <h2>${p.Titulo}</h2>
            <p class="meta">${p.Descripcion || ''}</p>
            <p class="precio"><strong>Precio:</strong> Bs.${p.Precio || ''}</p>
            <p class="disponibilidad"><strong>Disponibilidad:</strong> ${p.Disponibilidad || ''}</p>
            <div class="carrusel" id="${idCarr}">
              <img class="imagen-carrusel" src="${firstImg}" alt="${p.Titulo}">
              <div class="controles-carrusel">
                <button class="flecha izq" type="button" data-carr="${idCarr}" data-dir="-1">◀</button>
                <span class="contador-fotos">${imagenes.length > 0 ? '1 / ' + imagenes.length : ''}</span>
                <button class="flecha der" type="button" data-carr="${idCarr}" data-dir="1">▶</button>
              </div>
            </div>
          `;
          div.dataset.imagenes = JSON.stringify(imagenes);
          div.dataset.indice = "0";
          cont.appendChild(div);
        });

        inicializarListas();
      },
      error: () => inicializarListas()
    });

    /* ====== NAVEGACIÓN Y PAGINACIÓN ====== */
    function inicializarListas() {
      todosProductos = Array.from(document.querySelectorAll('.producto'));
      productosActivos = todosProductos.slice();
      crearPaginacion(productosActivos.length);
      mostrarPagina(1);
    }

    function mostrarPagina(pagina) {
      const totalPaginas = Math.ceil(productosActivos.length / productosPorPagina);
      
      // Validar rango de página
      if (pagina < 1) pagina = 1;
      if (pagina > totalPaginas) pagina = totalPaginas;
      
      paginaActual = pagina;
      const inicio = (paginaActual - 1) * productosPorPagina;
      const fin = paginaActual * productosPorPagina;

      // Ocultar todos y mostrar solo los del rango
      todosProductos.forEach(el => el.style.display = 'none');
      productosActivos.forEach((el, idx) => {
        el.style.display = (idx >= inicio && idx < fin) ? '' : 'none';
      });

      actualizarBotonesPaginacion();

      // EFECTO: Volver arriba suavemente
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function crearPaginacion(total) {
      const totalPag = Math.max(1, Math.ceil(total / productosPorPagina));
      const pagDiv = document.getElementById('paginacion');
      pagDiv.innerHTML = '';

      // BOTÓN ANTERIOR
      const btnAnt = document.createElement('button');
      btnAnt.innerText = '«';
      btnAnt.id = 'btn-ant';
      btnAnt.onclick = () => mostrarPagina(paginaActual - 1);
      pagDiv.appendChild(btnAnt);

      // NÚMEROS DE PÁGINA
      for (let i = 1; i <= totalPag; i++) {
        const btn = document.createElement('button');
        btn.type = 'button'; btn.innerText = i; btn.dataset.page = i;
        btn.onclick = () => mostrarPagina(i);
        pagDiv.appendChild(btn);
      }

      // BOTÓN SIGUIENTE
      const btnSig = document.createElement('button');
      btnSig.innerText = '»';
      btnSig.id = 'btn-sig';
      btnSig.onclick = () => mostrarPagina(paginaActual + 1);
      pagDiv.appendChild(btnSig);

      actualizarBotonesPaginacion();
    }

    function actualizarBotonesPaginacion() {
      const totalPaginas = Math.ceil(productosActivos.length / productosPorPagina);
      
      // Actualizar estado de los números
      document.querySelectorAll('#paginacion button[data-page]').forEach(b => {
        b.classList.toggle('active', parseInt(b.dataset.page) === paginaActual);
      });

      // Habilitar/Deshabilitar flechas
      const btnAnt = document.getElementById('btn-ant');
      const btnSig = document.getElementById('btn-sig');

      if (btnAnt) btnAnt.disabled = (paginaActual === 1);
      if (btnSig) btnSig.disabled = (paginaActual === totalPaginas || totalPaginas === 0);
      
      // Estilo visual para botones deshabilitados
      [btnAnt, btnSig].forEach(btn => {
        if(btn) btn.style.opacity = btn.disabled ? "0.4" : "1";
      });
    }

    /* ====== BUSCADOR Y ORDENAMIENTO ====== */
    document.getElementById('buscador').addEventListener('input', function() {
      const q = this.value.trim().toLowerCase();
      productosActivos = q === '' 
        ? todosProductos.slice() 
        : todosProductos.filter(p => p.innerText.toLowerCase().includes(q));
      
      crearPaginacion(productosActivos.length);
      mostrarPagina(1);
    });

    function extraerPrecio(el) {
      const p = el.querySelector('.precio');
      if (!p) return 0;
      let txt = p.innerText.toLowerCase()
        .replace('precio:', '').replace('bs.', '').replace(/\s/g, '').replace(/\./g, '').replace(',', '.');
      return parseFloat(txt) || 0;
    }

    document.getElementById('orden').addEventListener('change', function() {
      const criterio = this.value;
      const cont = document.getElementById('catalogo');
      
      productosActivos.sort((a, b) => {
        if (criterio === 'titulo') return a.querySelector('h2').innerText.localeCompare(b.querySelector('h2').innerText);
        const pa = extraerPrecio(a), pb = extraerPrecio(b);
        return criterio === 'precioAsc' ? pa - pb : pb - pa;
      });

      productosActivos.forEach(i => cont.appendChild(i));
      mostrarPagina(1);
    });

    /* ====== LÓGICA DEL CARRUSEL ====== */
    document.addEventListener('click', function(e) {
      const btn = e.target.closest('button[data-carr]');
      if (!btn) return;

      const id = btn.dataset.carr;
      const dir = parseInt(btn.dataset.dir);
      const carr = document.getElementById(id);
      const tarjeta = carr.closest('.producto');
      const imgs = JSON.parse(tarjeta.dataset.imagenes || '[]');
      if (!imgs.length) return;

      let idx = parseInt(tarjeta.dataset.indice);
      idx = (idx + dir + imgs.length) % imgs.length;
      tarjeta.dataset.indice = idx;

      const contadorEl = carr.querySelector('.contador-fotos');
      if (contadorEl) contadorEl.innerText = `${idx + 1} / ${imgs.length}`;

      const imgEl = carr.querySelector('.imagen-carrusel');
      if (imgEl) {
        carr.classList.add('loading');
        imgEl.src = imgs[idx];
        imgEl.onload = () => carr.classList.remove('loading');
        imgEl.onerror = () => carr.classList.remove('loading');
      }
    });

    /* ====== LIGHTBOX ====== */
    const lightbox = document.getElementById('lightbox');
    const lightboxImg = document.getElementById('lightbox-img');

    document.addEventListener('click', function(e) {
      const img = e.target.closest('img.imagen-carrusel');
      if (img) {
        lightboxImg.src = img.src;
        lightbox.style.display = 'flex';
        lightbox.setAttribute('aria-hidden', 'false');
      }
    });

    lightbox.addEventListener('click', (e) => {
      if (e.target !== lightboxImg) {
        lightbox.style.display = 'none';
        lightbox.setAttribute('aria-hidden', 'true');
        lightboxImg.src = '';
      }
    });
  </script>
</body>
</html>